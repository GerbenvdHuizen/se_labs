
<!--

-->

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title></title>
        <script type="text/javascript" src="D3/d3.v3.js"></script>
        <style>
		body{
            font-family:"Arial";
		}
		
		.mono text,
		.legend text,
		.row text,
		.column text {
			-webkit-touch-callout: none;
			-webkit-user-select: none;
			-khtml-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none;
		}
		
		.row rect,
		.column rect,
		.cell rect {
			shape-rendering: geometricPrecision;
		}
		
		</style>
    </head>
<body>
<script>

	d3.text("cloneFiles.csv", function(text) {
		var parsedData = d3.csv.parseRows(text);
		var clonesFilesData = [];
		var fileArray = [];
		for (var i = 1; i < parsedData.length; i++) {
			fileArray.push(parsedData[i][0]);
			clonesFilesData.push([parsedData[i][0], parsedData[i][1], parseInt(parsedData[i][2])]);
			
		}
		
		function uniq(a) {
			var seen = {};
			return a.filter(function(item) {
				return seen.hasOwnProperty(item) ? false : (seen[item] = true);
			});
		}
		
		function fillMatrix(first, second) {
			var x = 0;
			for (var i = 1; i < clonesFilesData.length; i++) {
				if (clonesFilesData[i][0] == first && clonesFilesData[i][1] == second) {
					x = clonesFilesData[i][2];
				}
			}
			return x;
		}
		
		var uniqueFiles = uniq(fileArray);
		
		var margin = {top: 175, right: 100, bottom: 100, left: 325},
			width = 1400,
			height = 1000;
			
		var svg = d3.select("body").append("svg")
			.attr("width", width + margin.left + margin.right)
			.attr("height", height + margin.top + margin.bottom)
			.style("margin-left", (-0.5* margin.left) + "px")
		  .append("g")
			.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
			
		svg.append("rect")
			.attr("class", "background")
			.attr("width", width)
			.attr("height", height);
			
		var numrows = uniqueFiles.length;
		var numcols = uniqueFiles.length;
		var matrix = new Array(numrows);
		
		for (var i = 0; i < numrows; i++) {
		  matrix[i] = new Array(numcols);
		  for (var j = 0; j < numcols; j++) {
			matrix[i][j] = fillMatrix(uniqueFiles[i], uniqueFiles[j]);
		  }
		}
		console.log(clonesFilesData);
		//console.log(uniqueFiles);
		console.log(matrix);
		
		var x = d3.scale.ordinal()
			.domain(d3.range(numcols))
			.rangeBands([0, width]);
			
		var y = d3.scale.ordinal()
			.domain(d3.range(numrows))
			.rangeBands([0, height]);
		
		var colors = ["white","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8"];
		var gridSize = Math.floor(height / 24);
		var legendElementWidth = gridSize*2;
		var rowLabels = new Array(numrows);
		
		for (var i = 0; i < numrows; i++) {
		  rowLabels[i] = uniqueFiles[i];
		}
		
		var columnLabels = new Array(numrows);
		
		for (var i = 0; i < numcols; i++) {
		  columnLabels[i] = uniqueFiles[i];
		}
		
		var colorMap = d3.scale.quantile()
			.domain([0,1,2,3, 5, 15, 40])
			//["white","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494"]
			.range(["white","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8"]);    
			//.range(["red", "black", "green"]);
			//.range(["brown", "#ddd", "darkgreen"]);
			
		var row = svg.selectAll(".row")
			.data(matrix)
		  .enter().append("g")
			.attr("class", "row")
			.attr("transform", function(d, i) { return "translate(0," + y(i) + ")"; });
		
		row.selectAll(".cell")
			.data(function(d) { return d; })
		  .enter().append("rect")
			.attr("class", "cell")
			.attr("x", function(d, i) { return x(i); })
			.attr("width", x.rangeBand())
			.attr("height", y.rangeBand())
			.style("stroke-width", 0.1)
			.style("stroke", "black");
		
		row.append("line")
			.attr("x2", width);
		
		row.append("text")
			.attr("x", 0)
			.attr("y", y.rangeBand() / 2)
			.attr("dy", ".32em")
			.attr("dx", "-.32em")
			.attr("text-anchor", "end")
			.style("font-size","10px")
			.text(function(d, i) { return uniqueFiles[i]; });
			
		var column = svg.selectAll(".column")
			.data(columnLabels)
		  .enter().append("g")
			.attr("class", "column")
			.attr("transform", function(d, i) { return "translate(" + x(i) + ")rotate(-90)"; });
		
		column.append("line")
			.attr("x1", -width);
		
		column.append("text")
			.attr("x", 6)
			.attr("y", y.rangeBand() / 2)
			.attr("dy", ".64em")
			.attr("text-anchor", "start")
			.style("font-size","10px")
			.text(function(d, i) { return d; });
		
		row.selectAll(".cell")
			.data(function(d, i) { return matrix[i]; })
			.style("fill", colorMap);
			
		var legend = svg.selectAll(".legend")
		  .data([0].concat(colorMap.quantiles()), function(d) { return d; });

		legend.enter().append("g")
		  .attr("class", "legend");

		legend.append("rect")
		.attr("x", width + (gridSize / 2))
		.attr("y", function(d, i) { return legendElementWidth * i; })
		.attr("width", gridSize / 2)
		.attr("height", legendElementWidth)
		.style("stroke", "black")
		.style("fill", function(d, i) { return colors[i]; });

		legend.append("text")
		.attr("class", "mono")
		.text(function(d) { 
			if (d >= 5)
				return "â‰¥ " + Math.round(d); 
			else 
				return Math.round(d);})
		.attr("dy", ".75em")
		.attr("x", width + (1.1*gridSize))
		.attr("y", function(d, i) { return (legendElementWidth* i); });

	});
</script>